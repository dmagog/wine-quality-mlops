# Wine Quality MLOps Project

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wine-quality-mlops/
‚îÇ
‚îú‚îÄ‚îÄ .github/workflows/          # CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã GitHub Actions
‚îú‚îÄ‚îÄ dags/                       # DAG-—Ñ–∞–π–ª—ã Airflow
‚îú‚îÄ‚îÄ data/                       # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (DVC —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º—ã–º)
‚îú‚îÄ‚îÄ mlruns/                     # –ö–∞—Ç–∞–ª–æ–≥ –ª–æ–≥–æ–≤ MLflow
‚îú‚îÄ‚îÄ models/                     # –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (—á–µ—Ä–µ–∑ DVC)
‚îú‚îÄ‚îÄ src/                        # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∏ utils)
‚îú‚îÄ‚îÄ tests/                      # –¢–µ—Å—Ç—ã FastAPI
‚îú‚îÄ‚îÄ .dvc/                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DVC
‚îú‚îÄ‚îÄ Dockerfile                  # Docker-—Ñ–∞–π–ª –¥–ª—è Airflow/FastAPI
‚îú‚îÄ‚îÄ docker-compose.yml          # –û—Å–Ω–æ–≤–Ω–æ–π docker-compose
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ api/                        # FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îî‚îÄ‚îÄ README.md                   # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã `Docker`, `docker-compose`, `make`.
2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/<–≤–∞—à-–ø—Ä–æ—Ñ–∏–ª—å>/wine-quality-mlops.git
cd wine-quality-mlops
```

3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DVC –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
```bash
make dvc-init
make dvc-pull
```

### –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
make up
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
- Airflow: http://localhost:8081
- MLflow: http://localhost:5001
- FastAPI: http://localhost:8000/docs

## üî¨ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

- –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π LogisticRegression, DecisionTree –∏ RandomForest —Å —Ä–∞–∑–Ω—ã–º–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- –ú–µ—Ç—Ä–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ MLflow (accuracy, F1, ROC AUC, confusion matrix).
- –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ MLflow run.
- –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ DVC.

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π –≤ MLflow:

- –ù–∞–∑–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞: `wine_quality_experiment`
- –¢–µ–≥–∏: `model_name`, `dataset_version`, `dataset_path`
- –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: `confusion_matrix.png`, `model.pkl`

## üèÜ –í—ã–±–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏

- DAG `register_best_model_from_mlflow.py` –∏—â–µ—Ç run —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π `f1_score`.
- –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `models/best_model.pkl` –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ DVC.

## üåê FastAPI

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç endpoint `/predict` –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∏–Ω–∞.
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```json
POST /predict
{
  "fixed_acidity": 7.4,
  "volatile_acidity": 0.7,
  ...
}
```

## ‚úÖ CI/CD

–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- `ruff` ‚Äî –ª–∏–Ω—Ç–µ—Ä
- `pytest` ‚Äî —Ç–µ—Å—Ç—ã API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

CI/CD –Ω–∞ GitHub Actions: `.github/workflows/api-ci.yml`

## üîó Merge Request

[–°—Å—ã–ª–∫–∞ –Ω–∞ Merge Request](https://github.com/<–≤–∞—à-–ø—Ä–æ—Ñ–∏–ª—å>/wine-quality-mlops/pull/X)

## üîç –ö–∞–∫ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å

### 1. –û–±—É—á–µ–Ω–∏–µ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π

–í DAG `train_ml_models` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–±—É—á–µ–Ω–∏–µ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π:
- `RandomForestClassifier` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –Ω–∞–±–æ—Ä–∞–º–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- `DecisionTreeClassifier` —Ç–∞–∫–∂–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç** (`mlflow.start_run()`), –≥–¥–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –í—Å–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`mlflow.log_params()`).
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞: accuracy, F1, ROC-AUC, confusion matrix (`mlflow.log_metrics()` –∏ `mlflow.log_figure()`).
- –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (`mlflow.log_artifact()`).
- –í–µ—Ä—Å–∏—è –∏ –ø—É—Ç—å –¥–∞—Ç–∞—Å–µ—Ç–∞, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑ DVC (`mlflow.set_tag()`).

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, **–∫–∞–∂–¥–æ–µ –æ–±—É—á–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π `run` –≤ MLflow**, –∏ –≤—Å–µ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã —Å –æ–¥–Ω–∏–º –∏–º–µ–Ω–µ–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `"wine_quality_experiment"`.

### 2. DAG –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏

–°–ª–µ–¥—É—é—â–∏–π DAG ‚Äî `register_best_model_from_mlflow.py` ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ `runs` –≤–Ω—É—Ç—Ä–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞.

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –ß–µ—Ä–µ–∑ `mlflow.search_runs()` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ `runs` –∏–∑ MLflow.
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ `FINISHED` —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ DataFrame, –¥–∞–ª–µ–µ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Ü–µ–ª–µ–≤–æ–π –º–µ—Ç—Ä–∏–∫–µ (—É –≤–∞—Å —ç—Ç–æ `f1_score`).
- –õ—É—á—à–∏–π `run` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ —Ç–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ `f1_score` –º–∞–∫—Å–∏–º–∞–ª–µ–Ω.

```python
runs_df = mlflow.search_runs(experiment_ids=[experiment.experiment_id], filter_string="attributes.status = 'FINISHED'")
best_run = runs_df.sort_values("metrics.f1_score", ascending=False).iloc[0]
```

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª—É—á—à–µ–≥–æ `run`:
- –ò–∑ MLflow –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏.
- –ú–æ–¥–µ–ª—å –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `artifacts/best_model.pkl`.
- –§–∞–π–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ DVC (`dvc add`, `dvc push`) –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ Git (`git commit`, `git push`).

### 4. –ü–æ—á–µ–º—É —ç—Ç–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MLflow ‚Äî –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è, –∏–∑—É—á–∏—Ç—å, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏.
- ‚úÖ **–ß–µ—Å—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**: –≤—ã–±–æ—Ä –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π –º–µ—Ç—Ä–∏–∫–µ (`f1_score`), –Ω–∞ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –≤—ã–±–æ—Ä–∫–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- ‚úÖ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –≤—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MLflow –∏ DVC, –≤–∫–ª—é—á–∞—è –º–æ–¥–µ–ª–∏ –∏ –¥–∞–Ω–Ω—ã–µ.