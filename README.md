# Wine Quality MLOps Project

## üåç –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å–≤—è—â—ë–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –ø–æ–ª–Ω–æ–≥–æ MLOps-–ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è –∑–∞–¥–∞—á–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∏–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: Airflow, MLflow, DVC, FastAPI, MinIO, GitHub Actions.

–¶–µ–ª—å: –æ—Ç—Å–ª–µ–¥–∏—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã, –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à—É—é –º–æ–¥–µ–ª—å, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å API –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wine-quality-mlops/
‚îú‚îÄ‚îÄ .github/workflows/          # GitHub Actions workflows (CI/CD)
‚îú‚îÄ‚îÄ api/                        # FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ dags/                       # Airflow DAGs
‚îÇ   ‚îú‚îÄ‚îÄ train_models.py
‚îÇ   ‚îú‚îÄ‚îÄ register_best_model_from_mlflow.py
‚îÇ   ‚îî‚îÄ‚îÄ full_training_pipeline.py
‚îú‚îÄ‚îÄ mlruns/                     # MLflow –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
‚îú‚îÄ‚îÄ models/                     # –õ–æ–∫–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (—á–µ—Ä–µ–∑ DVC)
‚îú‚îÄ‚îÄ src/                        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ train.py                # –û–±—É—á–µ–Ω–∏–µ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ utils.py                # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö, —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ tests/                      # –¢–µ—Å—Ç—ã FastAPI
‚îÇ   ‚îî‚îÄ‚îÄ test_api.py
‚îú‚îÄ‚îÄ Dockerfile                  # –û–±—â–∏–π Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml          # –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md                   # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```

---

## üî¢ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∑–∞–ø—É—Å–∫

### 1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã:

* Airflow: [http://localhost:8081](http://localhost:8081)
* MLflow: [http://localhost:5001](http://localhost:5001)
* FastAPI: [http://localhost:8000/docs](http://localhost:8000/docs)

### 2. DVC

–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

```bash
dvc pull
```

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏:

```bash
dvc add models/best_model.pkl
```

### 3. FastAPI endpoints

* `GET /healthcheck` ‚Äî —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
* `POST /predict` ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –≤–∏–Ω–∞

### 4. CI/CD

–ü—Ä–∏ push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:

* –ª–∏–Ω—Ç–µ—Ä (`ruff`)
* unit-—Ç–µ—Å—Ç—ã (`pytest`)
* –ø—Ä–æ–≤–µ—Ä–∫–∞ API (`FastAPI TestClient`)

---

## üéì –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

–û–±—É—á–∞—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π (LogisticRegression, DecisionTree –∏ RandomForest) —Å —Ä–∞–∑–Ω—ã–º–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ MLflow:

* accuracy, f1, AUC-ROC, confusion matrix
* —Ç–µ–≥–∏: –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏, –≤–µ—Ä—Å–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞, –ø—É—Ç—å –∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—É

–í—ã–±–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ f1-–º–µ—Ç—Ä–∏–∫–∏. –ü–æ–±–µ–¥–∏—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `models/best_model.pkl` –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ DVC.

## üîç –ö–∞–∫ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å

### 1. –û–±—É—á–µ–Ω–∏–µ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π

–í DAG `train_ml_models` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–±—É—á–µ–Ω–∏–µ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –Ω–∞–±–æ—Ä–∞–º–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç** (`mlflow.start_run()`), –≥–¥–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –í—Å–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`mlflow.log_params()`).
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞: accuracy, F1, ROC-AUC, confusion matrix.
- –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (`mlflow.log_artifact()`).
- –í–µ—Ä—Å–∏—è –∏ –ø—É—Ç—å –¥–∞—Ç–∞—Å–µ—Ç–∞, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑ DVC (`mlflow.set_tag()`).

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, **–∫–∞–∂–¥–æ–µ –æ–±—É—á–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π `run` –≤ MLflow**, –∏ –≤—Å–µ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã —Å –æ–¥–Ω–∏–º –∏–º–µ–Ω–µ–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `"wine_quality_experiment"`.

### 2. DAG –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏

–°–ª–µ–¥—É—é—â–∏–π DAG ‚Äî `register_best_model_from_mlflow.py` ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ `runs` –≤–Ω—É—Ç—Ä–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞.

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –ß–µ—Ä–µ–∑ `mlflow.search_runs()` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ `runs` –∏–∑ MLflow.
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ `FINISHED` —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ DataFrame, –¥–∞–ª–µ–µ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Ü–µ–ª–µ–≤–æ–π –º–µ—Ç—Ä–∏–∫–µ (—É –≤–∞—Å —ç—Ç–æ `f1_score`).
- –õ—É—á—à–∏–π `run` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ —Ç–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ `f1_score` –º–∞–∫—Å–∏–º–∞–ª–µ–Ω.

```python
runs_df = mlflow.search_runs(experiment_ids=[experiment.experiment_id], filter_string="attributes.status = 'FINISHED'")
best_run = runs_df.sort_values("metrics.f1_score", ascending=False).iloc[0]
```

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª—É—á—à–µ–≥–æ `run`:
- –ò–∑ MLflow –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏.
- –ú–æ–¥–µ–ª—å –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `artifacts/best_model.pkl`.
- –§–∞–π–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ DVC (`dvc add`, `dvc push`) –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ Git (`git commit`, `git push`).